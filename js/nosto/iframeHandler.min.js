(function(window){"use strict";var handlePostMessage=function(data,options){var TYPE_NEW_ACCOUNT="newAccount",TYPE_CONNECT_ACCOUNT="connectAccount",TYPE_SYNC_ACCOUNT="syncAccount",TYPE_REMOVE_ACCOUNT="removeAccount";var settings=extendObject({iframeId:"nosto_iframe",urls:{createAccount:"",connectAccount:"",syncAccount:"",deleteAccount:""}},options);var $iframe=document.getElementById(settings.iframeId);switch(data.type){case TYPE_NEW_ACCOUNT:var post_data={email:data.params.email};if(data.params.details){post_data.details=JSON.stringify(data.params.details)}xhr(settings.urls.createAccount,{data:post_data,success:function(response){if(response.redirect_url){$iframe.src=response.redirect_url}}});break;case TYPE_CONNECT_ACCOUNT:xhr(settings.urls.connectAccount,{success:function(response){if(response.success&&response.redirect_url){window.location.href=response.redirect_url}else if(!response.success&&response.redirect_url){$iframe.src=response.redirect_url}}});break;case TYPE_SYNC_ACCOUNT:xhr(settings.urls.syncAccount,{success:function(response){if(response.success&&response.redirect_url){window.location.href=response.redirect_url}else if(!response.success&&response.redirect_url){$iframe.src=response.redirect_url}}});break;case TYPE_REMOVE_ACCOUNT:xhr(settings.urls.deleteAccount,{success:function(response){if(response.redirect_url){$iframe.src=response.redirect_url}}});break;default:throw new Error("Nosto: invalid postMessage `type`.")}};function xhr(url,params){var options=extendObject({method:"POST",async:true,data:{}},params);options.data.form_key=window.FORM_KEY;var oReq=new XMLHttpRequest;if(typeof options.success==="function"){oReq.addEventListener("load",function(e){options.success(JSON.parse(e.target.response))},false)}oReq.open(options.method,decodeURIComponent(url),options.async);oReq.setRequestHeader("X-Requested-With","XMLHttpRequest");oReq.setRequestHeader("Content-Type","application/x-www-form-urlencoded");oReq.send(buildQueryString(options.data))}function extendObject(obj1,obj2){for(var key in obj2){if(obj2.hasOwnProperty(key)){obj1[key]=obj2[key]}}return obj1}function buildQueryString(params){var queryString="";for(var key in params){if(params.hasOwnProperty(key)){if(queryString!==""){queryString+="&"}queryString+=encodeURIComponent(key)+"="+encodeURIComponent(params[key])}}return queryString}window.Nosto=window.Nosto||{};window.Nosto.handlePostMessage=handlePostMessage})(window||{});